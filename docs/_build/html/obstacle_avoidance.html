

<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Obstacle Avoidance &mdash; SunFounder_PiCar-S  ドキュメント</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://ezblock.cc/readDocFile/topHead.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
        <script src="https://ezblock.cc/readDocFile/topHead.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="next" title="Light Following" href="light_following.html" />
    <link rel="prev" title="Arming the Car!" href="arming_the_car.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SunFounder_PiCar-S
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="components_list.html">Components List</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_the_car.html">Building the Car</a></li>
<li class="toctree-l1"><a class="reference internal" href="circuits_building.html">Circuits Building</a></li>
<li class="toctree-l1"><a class="reference internal" href="get_started_with_raspberry_pi.html">Get Started with Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="servo_configuration.html">Servo Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="calibration.html">Calibration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="arming_the_car.html">Arming the Car!</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Obstacle Avoidance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-it-works">How it Works</a></li>
<li class="toctree-l3"><a class="reference internal" href="#procedures">Procedures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-explanation-for-ultra-sonic-avoid-py">Code Explanation for ultra_sonic_avoid.py</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="light_following.html">Light Following</a></li>
<li class="toctree-l2"><a class="reference internal" href="line_following.html">Line Following</a></li>
<li class="toctree-l2"><a class="reference internal" href="combination.html">Combination</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SunFounder_PiCar-S</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="arming_the_car.html">Arming the Car!</a> &raquo;</li>
        
      <li>Obstacle Avoidance</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/obstacle_avoidance.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="obstacle-avoidance">
<h1>Obstacle Avoidance<a class="headerlink" href="#obstacle-avoidance" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="section" id="how-it-works">
<h2>How it Works<a class="headerlink" href="#how-it-works" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>The ultrasonic obstacle avoidance module detects and transfers the
collected data to Raspberry Pi that can calculate the distance from the
obstacle. The Pi will send a command to adjust the front wheels and rear
wheels direction and rotation to control the PiCar-S walk away from the
obstacle if there is one.</p>
</div>
<div class="section" id="procedures">
<h2>Procedures<a class="headerlink" href="#procedures" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><strong>Step 1 Assembly</strong></p>
<p>① Connect the ultrasonic module to the ultrasonic connector with M1.4*8
screws and M1.4 nuts.</p>
<p>② Then connect them to the ultrasonic support with M3*10 screws and M3
nuts.</p>
<p>③ Finally,assemble them to the Upper Plate with M3*10 screws and M3
nuts.</p>
<img alt="_images/image233.png" src="_images/image233.png" />
<p><strong>Reminder: It would be easier to place the nuts into the slots with
your fingers to hold underneath.</strong></p>
<p><strong>Step 2 Wiring</strong></p>
<p>Connect the ultrasonic obstacle avoidance to Robot HATS with a 4-pin
anti-reverse cable as shown below.</p>
<p>Ultrasonic module can have a 5V or 3.3V power supply. Here, we give it a
3.3V power supply.</p>
<img alt="_images/image234.png" src="_images/image234.png" />
<img alt="_images/image108.png" src="_images/image108.png" />
<p><strong>Step 3 Test</strong></p>
<p>First, test the ultrasonic obstacle avoidance module before applying.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">SunFounder_PiCar</span><span class="o">-</span><span class="n">S</span><span class="o">/</span><span class="n">example</span><span class="o">/</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">test_ultrasonic_module</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<img alt="_images/image109.png" src="_images/image109.png" />
<p>You may find that the distance measurement may be not that accurate. It
doesn’t matter. This 25kHz ultrasonic module is not a commonly used one,
but one has a <strong>horizontal detecting range of about 30~40 degrees</strong>.
Thus the distance measured may be not so accurate, but that small range
provides convenience for obstacle avoidance. Besides, since the
Raspberry Pi is not a real-time operating system, the inaccurate time
calculation will affect the accuracy of distance measurement too.
However, this ultrasonic module is precise enough for obstacle
avoidance.</p>
<p><strong>Step 4. Get on the road!</strong></p>
<p>Now we have a general idea of the ultrasonic module’s effect after the
test above. Let’s run the code of the ultrasonic obstacle avoidance.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">ultra_sonic_avoid</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The PiCar-S starts running now. Just place the car on the ground. It
will follow the program to turn when it detects an obstacle; if the
obstacle is too close, it will move backwards, and turn left/right. You
can also modify the threshold of obstacle detecting range and that of
moving backwards in the code.</p>
<img alt="_images/image235.png" src="_images/image235.png" />
</div>
<div class="section" id="code-explanation-for-ultra-sonic-avoid-py">
<h2>Code Explanation for ultra_sonic_avoid.py<a class="headerlink" href="#code-explanation-for-ultra-sonic-avoid-py" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><strong>Whole Work Flow</strong></p>
<img alt="_images/image236.png" src="_images/image236.png" />
<p>The ultrasonic module returns a digital value, i.e., High or Low level,
and the interval time between two levels returned can be converted to
the distance to the obstacle. Thus, we call the time module in Python
for timing here. The formula to calculate the distance is written in the
ultrasonic module’s driver. The main program just calls the
corresponding program to get the distance value.</p>
<p><strong>Subflow of the Obstacle Avoidance Function</strong></p>
<img alt="_images/image237.png" src="_images/image237.png" />
<p>When the car starts, it will detect obstacles and measure the distance
in cycle, make judgement, and take actions. Here are three cases: when
the distance to the obstacle is equals to the threshold, the car will
turn directions; when the distance is less than the threshold, the car
will move backwards before turning direction; when the distance is more
than the threshold, it will keep moving forwards.</p>
<img alt="_images/image235.png" src="_images/image235.png" />
<p><strong>Functions Explanation</strong></p>
<p><strong>ua = Ultra_Sonic.UltraSonic_Avoidance(17)</strong></p>
<p>Create an object <strong>ua</strong> of a <em>UltraSonic_Avoidance</em> class in the
Ultra_Sonic module. The number in the round bracket is the initial
parameter, which represents the pin number the SIG of the module is
connected to. Since the BCM naming method is applied, the corresponding
pin on the Raspberry Pi is #17.</p>
<p><strong>back_distance</strong> and <strong>turn_distance</strong>, two constants are to set the
thresholds of the ranging distance.</p>
<p><strong>while()</strong> loop</p>
<p>When the detected distance is less than the <strong>back_distance</strong>, the car
will move backwards; when it is between <strong>back_distance</strong> and
<strong>turn_distance</strong>, the car will turn a direction (you can set the
turning angle in the aforementioned parameter <strong>turning_angle</strong> and the
angle can be a positive or negative number, for turning left or turning
right respectively; <strong>NOTE</strong> that the number of the turning angle should
be <strong>-90 to 90</strong> considering the servo’s max rotation degrees, or the
servo may be burnt.); when the detected distance is greater than the
<strong>turn_distance</strong>, the car will keep moving forward.</p>
<p><strong>bw.backward()</strong>, making the rear wheels rotate backwards;
<strong>bw.forward()</strong>, making the rear wheels spin forward. These two
functions in the rear wheel driving module back_wheels are to set the
wheel’s rotating direction.</p>
<p><strong>bw.set_speed(speed)</strong>, function in the back_wheels, to set the wheel's
rotating speed. The larger the number (within the range 0-100) is, the
faster the wheel rotates.</p>
<p><strong>fw.turn(angle)</strong>, function in the back_wheels, to set the turning
angle. The angle is 90 when the car moves straight forwards; reduce the
number to turn left, and increase it to turn right.</p>
<p><strong>fw.turn_straight()</strong>, making the front wheels return to the angle of
moving straight forwards.</p>
<p><strong>More:</strong></p>
<p><strong>back_distance</strong> and <strong>turn_distance</strong></p>
<p>Try to modify the constants to make the car back off and turn away in a
desired distance and angle as you like during the obstacle avoidance.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="light_following.html" class="btn btn-neutral float-right" title="Light Following" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="arming_the_car.html" class="btn btn-neutral float-left" title="Arming the Car!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, sunfounder.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>